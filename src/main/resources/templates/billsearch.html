<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common :: head(~{::title})">
  <title>校园电费缴费平台-查询</title>
  <script type="text/javascript" th:src="@{/js/jquery.min.js}"></script>
</head>
  
<body>

<div class="lyear-layout-web">
  <div class="lyear-layout-container">

    <!--左侧导航-->
    <aside th:replace="common :: sidebar">
    </aside>
    <!--End 左侧导航-->


    <!--头部信息-->
    <header class="lyear-layout-header" th:replace="common :: header('电费-查询')">
    </header>
    <!--End 头部信息-->

    
    <!--页面主要内容-->
    <main class="lyear-layout-content">     
      <div class="container-fluid">
   
        <div class="card-body">
          
          <div class="search-area-payhistory">
            <div class="form-group">
              <h4><strong>缴费单位/时间</strong></h4>
            </div>


            <form th:action="@{/electricity/findAllPaying}">
            <div class="search-area-bill-top-left">
              <select class="form-control"  id="campus" name="campus" size="1" onchange="changeCampus()">
              </select>
            </div>

            <div class="search-area-bill-top-medium">
              <select class="form-control" id="buildings" name="buildingNo" size="1" onchange="changeBuildings()">
              </select>
            </div>

            <div class="search-area-bill-top-right">
              <select class="form-control"  id="dormitories" name="dormitoryNo"  size="1">
              </select>
            </div>

            <div class="search-area-bill-top-right-right">
              <input class="form-control js-datepicker m-b-10" type="text" id="create_time" name="date" placeholder="年份-月份" value="" data-date-format="yyyy-mm">
            </div>

           
            <div class="search-area-payhistory-right">
              <button class="btn btn-dark mybtn" type="submit"><i class="mdi mdi-search-web"></i><strong>查询</strong></button>
          </div>
            </form>

         <div class="vain-area"></div>
          <div class="table-responsive">
            <table class="table table-bordered">
              
              <thead>
                <tr>
                  <th>编号</th>
                  <th>校区</th>
                  <th>楼栋</th>
                  <th>房号</th>
                  <th>时间</th>
                  <th>用电量</th>
                  <th>电费</th>
                  <th>是否支付</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>

            <div class="pagination">
              <a href="#!"class="btn btn-secondary btn-sm" ><i class="mdi mdi-arrow-left-thick"></i>上一页</a>
              <a href="#!" class="btn btn-secondary btn-sm" ><i class="mdi mdi-arrow-right-thick"></i>下一页</a>
            </div>
      </div>    
    </main>
    <!--End 页面主要内容-->
  </div>
</div>




<!--日期选择插件-->
<script src="../static/js/bootstrap-datepicker/bootstrap-datepicker.min.js" th:src="@{js/bootstrap-datepicker/bootstrap-datepicker.min.js}"></script>
<script src="../static/js/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js" th:src="@{/js/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js}"></script>
<!--时间选择插件-->
<script src="js/bootstrap-datetimepicker/moment.min.js" th:src="@{/js/bootstrap-datetimepicker/moment.min.js}"></script>
<script src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"th:src="@{js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js}"></script>
<script src="js/bootstrap-datetimepicker/locale/zh-cn.js" th:src="@{/js/bootstrap-datetimepicker/locale/zh-cn.js}"></script>
<script>

  loadCampus();

  function loadCampus() {

    $.ajax({
      url:"/payUnit/findAllCampus",
      type:"GET",
      dataType:"JSON",
      data:{

      },
      success:function(data){
        console.log(data[1]);
        for(var i = 0 ; i < data.length ; i ++){
          $("#campus").append("<option value="+data[i]+">"+data[i]+"</option>");
          console.log(data[i])
        }
        changeCampus();


      },
      error:function () {
        $("#message1").text("请先登录")
        $("#myModal").show()
      }
    })

  }

  function changeCampus() {

    var campus = $("#campus").val();
    console.log(campus);
    $("#buildings").empty();
    $("#dormitories").empty();

    $.ajax({
      url:"/payUnit/findAllBuildingsByCampus",
      type:"GET",
      dataType:"JSON",
      data:{
        campus:campus
      },
      success:function(data){
        console.log(data[1]);
        for(var i = 0 ; i < data.length ; i ++){
          $("#buildings").append("<option value="+data[i]+">"+data[i]+"</option>");
          console.log(data[i])
        }

        changeBuildings();


      },
      error:function () {
        $("#message1").text("请先登录")
        $("#myModal").show()
      }
    })

  }

  function changeBuildings() {

    var building = $("#buildings").val();
    console.log(building);
    $("#dormitories").empty();

    $.ajax({
      url:"/payUnit/findAllDormitoriesByBuilding",
      type:"GET",
      dataType:"JSON",
      data:{
        building:building
      },
      success:function(data){
        console.log(data[1]);
        for(var i = 0 ; i < data.length ; i ++){
          $("#dormitories").append("<option value="+data[i]+">"+data[i]+"</option>");
          console.log(data[i])
        }



      },
      error:function () {
        $("#message1").text("请先登录")
        $("#myModal").show()
      }
    })

  }

  function search() {

    var campus = $("#campus").val();
    var building = $("#buildings").val();
    var dormitory = $("#dormitories").val();
    var date = $("#date").val();


    $.ajax({
      url:"/electricity/findAllElectricitiesNotPaid",
      type:"GET",
      dataType:"JSON",
      data:{
        campus:campus,
        building:building,
        dormitory:dormitory,
        date:date
      },
      success:function(data){
        console.log(data[1]);
        for(var i = 0 ; i < data.length ; i ++){
          $("#dormitories").append("<option value="+data[i]+">"+data[i]+"</option>");
          console.log(data[i])
        }



      },
      error:function () {
        $("#message1").text("请先登录")
        $("#myModal").show()
      }
    })

  }


</script>
</body>
</html>